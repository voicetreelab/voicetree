/**
 * Floating Windows CSS
 *
 * Styles for the floating window overlay and individual windows
 */

/* Overlay container - sibling to cytoscape container */
.cy-floating-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1000;
  transform-origin: top left;
}

/* Individual floating windows */
.cy-floating-window {
  position: absolute;
  pointer-events: auto;
  min-width: 300px;
  min-height: 200px;
  /* max-height: 600px; */ /* Disabled to allow terminal windows to expand freely */
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
  color: var(--foreground);
}

/* Window wrapper container */
.cy-floating-window-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
}

/* Title bar - compact for editors, standard for terminals */
.cy-floating-window-title {
  padding: 4px 8px;
  background-color: var(--muted);
  border-bottom: 1px solid var(--border);
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  user-select: none;
  cursor: move;
}

/* Terminal title bar - standard height with title visible */
.cy-floating-window-terminal .cy-floating-window-title {
  padding: 8px 12px;
  justify-content: space-between;
}

.cy-floating-window-title.dragging {
  cursor: grabbing;
}

/* Title text - hidden for editors (compact bar) */
.cy-floating-window-title-text {
  display: none;
}

/* Terminal title text - visible */
.cy-floating-window-terminal .cy-floating-window-title-text {
  display: block;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Expand button (doubles/halves window size) */
.cy-floating-window-expand {
  all: unset;
  cursor: pointer;
  font-size: 14px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cy-floating-window-expand:hover {
  background-color: rgba(0, 0, 0, 0.1);
  border-radius: 4px;
}

/* Fullscreen button */
.cy-floating-window-fullscreen {
  all: unset;
  cursor: pointer;
  font-size: 14px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cy-floating-window-fullscreen:hover {
  background-color: rgba(0, 0, 0, 0.1);
  border-radius: 4px;
}

/* Close button */
.cy-floating-window-close {
  all: unset;
  cursor: pointer;
  font-size: 16px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cy-floating-window-close:hover {
  background-color: rgba(0, 0, 0, 0.1);
  border-radius: 4px;
}

/* Content area */
.cy-floating-window-content {
  flex: 1;
  overflow: auto;
}

/* Fullscreen mode - ensure proper background in light mode */
.cy-floating-window-content:fullscreen {
  background-color: var(--background, white);
}

/* Resizable windows */
.cy-floating-window.resizable {
  resize: both;
  overflow: auto;
}

/* Shadow nodes (invisible) */
.floating-window-node {
  opacity: 0;
}

/* Horizontal context menu pill backgrounds
 * Matches the floating window title bar color (--muted)
 * Supports light/dark mode via CSS variables
 * pointer-events: auto to re-enable clicks (parent container has pointer-events: none) */
.horizontal-menu-pill {
  display: flex;
  flex-direction: row;
  align-items: center;
  background: var(--muted);
  border-radius: 16px;
  padding: 4px 8px;
  pointer-events: auto;
}

/* Vertical submenu dropdown from horizontal menu
 * Uses CSS variables for dark mode support */
.horizontal-menu-submenu {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  display: none;
  flex-direction: column;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border-radius: 8px;
  padding: 2px 0;
  z-index: 10001;
  pointer-events: auto;
  color: var(--foreground);
}

/* CodeMirror Editor Styles */
/*// TODO BROKEN, frontmatter styling is applying to titles as well*/
/*!* YAML Frontmatter - Smaller, de-emphasized styling *!*/
/*!* Target DashLine (---) and FrontmatterContent nodes *!*/
/*.cm-content .cm-meta {*/
/*  font-size: 0.75rem;*/
/*  color: #888;*/
/*}*/

/* Ensure frontmatter delimiters (---) are visible */
/*.cm-line .cm-meta {*/
/*  display: inline;*/
/*}*/

/* rich-markdoc styles - hide formatting marks when not editing */
.cm-markdoc-hidden {
  display: none !important;
}

.cm-markdoc-bullet * {
  display: none;
}

.cm-markdoc-bullet::after {
  display: inline !important;
  color: darkgray;
  content: '•';
}

.cm-markdoc-renderBlock {
  font-family: sans-serif;
}

.cm-markdoc-renderBlock table {
  border-collapse: collapse;
  margin-left: 5px;
}

.cm-markdoc-renderBlock th,
.cm-markdoc-renderBlock td {
  border: 1px solid lightgray;
  padding: 5px 10px;
}

.cm-markdoc-renderBlock blockquote {
  border-left: 3px solid lightgray;
  padding-left: 10px;
  margin: 0 0 0 15px;
}

.cm-markdoc-renderBlock p {
  margin: 3px;
}

.cm-markdoc-tag {
  color: darkgray;
}

.cm-markdoc-code {
  font-family: monospace;
}

/* Heading 1 (single #) - Smaller size with underline retained */
/* Override the highlightStyle from codemirror-rich-markdoc */
/*.cm-content .cm-heading1 {*/
/*  font-size: 18px !important;*/
/*  text-decoration: underline !important;*/
/*  font-weight: bold;*/
/*  font-family: sans-serif;*/
/*}*/

/*THIS DOESNT WORK CodeMirror's auto-generated class names (`ͼo`, `ͼ7`) are  unstable and change between builds/loads.  Use CodeMirror's official `HighlightStyle.define()` API*/
/*.ͼo .ͼ7 {*/
/*    font-size: 18px !important;*/
/*    text-decoration: underline !important;*/
/*}*/

/* Transcription Preview Chip - floating confirmation UI for speech-to-text */
.transcription-preview-chip {
  position: fixed;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  backdrop-filter: blur(8px);
  z-index: 10000;
  max-width: 400px;
  font-size: 14px;
  pointer-events: auto;
}

.transcription-preview-chip .preview-text {
  flex: 1;
  overflow-wrap: break-word;
  word-wrap: break-word;
  color: var(--foreground);
}

.transcription-preview-chip .preview-hints {
  color: var(--muted-foreground);
  font-size: 12px;
  white-space: nowrap;
}

/* Diff highlighting in code blocks
 * Lines starting with + get green background
 * Lines starting with - get red background
 * Semi-transparent for subtle visual cue */
.cm-diff-added {
  background-color: rgba(34, 197, 94, 0.2); /* light green, 20% opacity */
}

.cm-diff-removed {
  background-color: rgba(239, 68, 68, 0.2); /* light red, 20% opacity */
}

/* Dark mode adjustments for diff highlighting */
.dark .cm-diff-added {
  background-color: rgba(34, 197, 94, 0.25);
}

.dark .cm-diff-removed {
  background-color: rgba(239, 68, 68, 0.25);
}

/* Wikilink title display - shows node title instead of ID */
.cm-wikilink-title {
  color: var(--primary, #3b82f6);
  font-style: italic;
  cursor: default;
}

.dark .cm-wikilink-title {
  color: var(--primary, #60a5fa);
}

/* CodeMirror 6 Selection Visibility Fix
 *
 * CM6 has a known issue where the selection highlight doesn't show properly:
 * 1. The selection layer renders BEHIND the content layer
 * 2. Selection rectangles for "select all" use extreme positioning (top: -1e9px)
 *    which causes them to end just above the visible content area
 *
 * Solution:
 * - Ensure transparent backgrounds so selection shows through
 * - Override the first selection rectangle's position to cover visible content
 */

/* Ensure content area is transparent so selection layer shows through */
.cm-editor .cm-content {
  background-color: transparent !important;
}

/* Selection highlight colors */
.cm-editor .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.3) !important;
}

.cm-editor.cm-focused .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.4) !important;
}

/* Dark mode selection */
.dark .cm-editor .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.4) !important;
}

.dark .cm-editor.cm-focused .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.5) !important;
}

/* Keep active line subtle so selection shows through */
.cm-editor .cm-activeLine {
  background-color: rgba(0, 0, 0, 0.03) !important;
}

/* Fix: CM6 positions the first selection rectangle at extreme negative top (-1e9px)
 * with a huge height. This causes it to end just above the visible content.
 * Override to position at top:0 with full viewport height to cover all content.
 *
 * KNOWN LIMITATION: This :first-child selector targets ALL first selection rectangles,
 * which could cause visual artifacts for partial selections or multi-cursor scenarios.
 * However, this is acceptable because:
 * 1. Cmd+A select-all is the primary use case that was broken
 * 2. Partial selections typically don't hit the extreme-positioning edge case
 * 3. The functional selection still works correctly even if visuals are slightly off
 */
.cm-editor .cm-selectionBackground:first-child {
  top: 0 !important;
  height: 100vh !important;
}