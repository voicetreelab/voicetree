/**
 * Floating Windows CSS
 *
 * Styles for the floating window overlay and individual windows
 */

/* Overlay container - sibling to cytoscape container */
.cy-floating-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1000;
  transform-origin: top left;
}

/* Individual floating windows */
.cy-floating-window {
  position: absolute;
  pointer-events: auto;
  min-width: 100px;
  min-height: 100px;
  /* max-height: 600px; */ /* Disabled to allow terminal windows to expand freely */
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
  color: var(--foreground);
}

/* Window wrapper container */
.cy-floating-window-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
}


/* Content area */
.cy-floating-window-content {
  flex: 1;
  overflow: auto;
}

/* Fullscreen mode - ensure proper background in light mode */
.cy-floating-window-content:fullscreen {
  background-color: var(--background, white);
}

/* Resizable windows - Phase 2C: macOS-style edge resizing replaces CSS resize: both */
.cy-floating-window.resizable {
  overflow: auto;
}

/* Shadow nodes (invisible) */
.floating-window-node {
  opacity: 0;
}

/* Horizontal context menu pill backgrounds
 * Matches the floating window title bar color (--muted)
 * Supports light/dark mode via CSS variables
 * pointer-events: auto to re-enable clicks (parent container has pointer-events: none) */
.horizontal-menu-pill {
  display: flex;
  flex-direction: row;
  align-items: center;
  background: var(--muted);
  border-radius: 16px;
  padding: 4px 8px;
  pointer-events: auto;
}

/* Ensure left and right pill groups have equal width for balanced centering
 * This keeps the spacer (and node circle) centered in the menu */
.horizontal-menu-left-group,
.horizontal-menu-right-group {
  flex: 1 1 0;
  min-width: 0;
}

.horizontal-menu-left-group {
  justify-content: flex-end;
}

.horizontal-menu-right-group {
  justify-content: flex-start;
}

/* Floating window chrome horizontal menu wrapper
 * Displays left and right pill groups with centered spacer for node circle gap
 * Draggable area for moving the floating window */
.cy-floating-window-horizontal-menu {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 0;
  padding: 8px;
  cursor: grab;
}

.cy-floating-window-horizontal-menu:active {
  cursor: grabbing;
}

/* Vertical submenu dropdown from horizontal menu
 * Uses CSS variables for dark mode support */
.horizontal-menu-submenu {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  display: none;
  flex-direction: column;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border-radius: 8px;
  padding: 2px 0;
  z-index: 10001;
  pointer-events: auto;
  color: var(--foreground);
}

/* CodeMirror Editor Styles */
/*// TODO BROKEN, frontmatter styling is applying to titles as well*/
/*!* YAML Frontmatter - Smaller, de-emphasized styling *!*/
/*!* Target DashLine (---) and FrontmatterContent nodes *!*/
/*.cm-content .cm-meta {*/
/*  font-size: 0.75rem;*/
/*  color: #888;*/
/*}*/

/* Ensure frontmatter delimiters (---) are visible */
/*.cm-line .cm-meta {*/
/*  display: inline;*/
/*}*/

/* rich-markdoc styles - hide formatting marks when not editing */
.cm-markdoc-hidden {
  display: none !important;
}

.cm-markdoc-bullet * {
  display: none;
}

.cm-markdoc-bullet::after {
  display: inline !important;
  color: darkgray;
  content: '•';
}

.cm-markdoc-renderBlock {
  font-family: sans-serif;
}

.cm-markdoc-renderBlock table {
  border-collapse: collapse;
  margin-left: 5px;
}

.cm-markdoc-renderBlock th,
.cm-markdoc-renderBlock td {
  border: 1px solid lightgray;
  padding: 5px 10px;
}

.cm-markdoc-renderBlock blockquote {
  border-left: 3px solid lightgray;
  padding-left: 10px;
  margin: 0 0 0 15px;
}

.cm-markdoc-renderBlock p {
  margin: 3px;
}

.cm-markdoc-tag {
  color: darkgray;
}

.cm-markdoc-code {
  font-family: monospace;
}

/* Heading 1 (single #) - Smaller size with underline retained */
/* Override the highlightStyle from codemirror-rich-markdoc */
/*.cm-content .cm-heading1 {*/
/*  font-size: 18px !important;*/
/*  text-decoration: underline !important;*/
/*  font-weight: bold;*/
/*  font-family: sans-serif;*/
/*}*/

/*THIS DOESNT WORK CodeMirror's auto-generated class names (`ͼo`, `ͼ7`) are  unstable and change between builds/loads.  Use CodeMirror's official `HighlightStyle.define()` API*/
/*.ͼo .ͼ7 {*/
/*    font-size: 18px !important;*/
/*    text-decoration: underline !important;*/
/*}*/

/* Transcription Preview Chip - floating confirmation UI for speech-to-text */
.transcription-preview-chip {
  position: fixed;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  backdrop-filter: blur(8px);
  z-index: 10000;
  max-width: 400px;
  font-size: 14px;
  pointer-events: auto;
}

.transcription-preview-chip .preview-text {
  flex: 1;
  overflow-wrap: break-word;
  word-wrap: break-word;
  color: var(--foreground);
}

.transcription-preview-chip .preview-hints {
  color: var(--muted-foreground);
  font-size: 12px;
  white-space: nowrap;
}

/* Diff highlighting in code blocks
 * Lines starting with + get green background
 * Lines starting with - get red background
 * Semi-transparent for subtle visual cue */
.cm-diff-added {
  background-color: rgba(34, 197, 94, 0.2); /* light green, 20% opacity */
}

.cm-diff-removed {
  background-color: rgba(239, 68, 68, 0.2); /* light red, 20% opacity */
}

/* Dark mode adjustments for diff highlighting */
.dark .cm-diff-added {
  background-color: rgba(34, 197, 94, 0.25);
}

.dark .cm-diff-removed {
  background-color: rgba(239, 68, 68, 0.25);
}

/* Wikilink title display - shows node title instead of ID */
.cm-wikilink-title {
  color: var(--primary, #3b82f6);
  font-style: italic;
  cursor: default;
}

.dark .cm-wikilink-title {
  color: var(--primary, #60a5fa);
}

/* CodeMirror 6 Selection Visibility Fix
 *
 * CM6 has a known issue where the selection highlight doesn't show properly:
 * 1. The selection layer renders BEHIND the content layer
 * 2. Selection rectangles for "select all" use extreme positioning (top: -1e9px)
 *    which causes them to end just above the visible content area
 *
 * Solution:
 * - Ensure transparent backgrounds so selection shows through
 * - Override the first selection rectangle's position to cover visible content
 */

/* Ensure content area is transparent so selection layer shows through */
.cm-editor .cm-content {
  background-color: transparent !important;
}

/* Selection highlight colors */
.cm-editor .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.3) !important;
}

.cm-editor.cm-focused .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.4) !important;
}

/* Dark mode selection */
.dark .cm-editor .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.4) !important;
}

.dark .cm-editor.cm-focused .cm-selectionBackground {
  background-color: rgba(59, 130, 246, 0.5) !important;
}

/* Keep active line subtle so selection shows through */
.cm-editor .cm-activeLine {
  background-color: rgba(0, 0, 0, 0.03) !important;
}

/* Dark mode gutter (line numbers) styling
 * The oneDark theme should handle this, but CSS overrides may interfere
 * Force dark background and light text for gutters in dark mode */
.dark .cm-editor .cm-gutters {
  background-color: var(--muted, #1e1e1e) !important;
  border-right: 1px solid var(--border, #333) !important;
}

.dark .cm-editor .cm-lineNumbers .cm-gutterElement {
  color: var(--muted-foreground, #6b7280) !important;
}

.dark .cm-editor .cm-activeLineGutter {
  background-color: rgba(255, 255, 255, 0.05) !important;
}

/* Fix: CM6 positions select-all rectangle at extreme negative top (-33Mpx) with huge height.
 * This causes it to end at y=0, not covering visible content.
 * The .cm-select-all class is added by JS when selection covers entire document.
 * This avoids the duplicate overlay issue that :first-child caused during drag selection. */
.cm-select-all .cm-editor .cm-selectionBackground:first-child {
  top: 0 !important;
  height: 100vh !important;
}

/* Wikilink autocomplete tooltip - ensure it appears above floating windows
 * The tooltip is rendered in document.body (via tooltips({ parent: document.body }))
 * to escape the overflow:auto clipping of .cy-floating-window-content.
 * Needs z-index > 1000 (.cy-floating-overlay) to appear on top. */
.cm-tooltip-autocomplete {
  z-index: 10001 !important;
}

/* =============================================================================
 * Bottom-Left Expand Button (Phase 2B)
 * Small icon button in bottom-left corner for expanding/minimizing window
 * Visually distinct from CSS resize handles
 * ============================================================================= */

.cy-floating-window-expand-corner {
  all: unset;
  cursor: pointer;
  position: absolute;
  bottom: 0;
  left: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 2px;
  background-color: var(--muted);
  border: 1px solid var(--border);
  color: var(--muted-foreground);
  opacity: 0.6;
  transition: opacity 0.15s ease, background-color 0.15s ease;
  z-index: 10; /* Above content but below menus */
}

.cy-floating-window-expand-corner:hover {
  opacity: 1;
  background-color: var(--accent);
  color: var(--foreground);
}

.cy-floating-window-expand-corner svg {
  width: 16px;
  height: 16px;
  stroke: currentColor;
  stroke-width: 2;
}

/* =============================================================================
 * Traffic Light Buttons (Phase 3)
 * macOS-style colored circles in horizontal menu: Close (light red), Pin (neutral gray), Fullscreen (soft green outline)
 * ============================================================================= */

/* Base traffic light button style - 17px circles (20% larger than original 14px) */
.traffic-light {
  all: unset;
  cursor: pointer;
  width: 17px;
  height: 17px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: 4px;
  transition: opacity 0.15s ease, transform 0.1s ease;
  flex-shrink: 0; /* Prevent squashing when inside flex containers */
}

/* First traffic light in a pill needs extra left margin to separate from menu items */
.horizontal-menu-pill .traffic-light:first-of-type {
  margin-left: -8px;
}

/* Compensate for 20% larger traffic light buttons (14px → 17px) overflowing pill container */
.horizontal-menu-pill .traffic-lights {
  margin-right: -4px;
}

.traffic-light:hover {
  opacity: 0.85;
  transform: scale(1.1);
}

.traffic-light:active {
  transform: scale(0.95);
}

/* Traffic light icons - tiny (7px, 20% larger than original 6px) and subtle */
.traffic-light svg {
  width: 7px;
  height: 7px;
  stroke-width: 2.5;
}

/* Close button - soft light red filled circle */
.traffic-light-close {
  background-color: rgba(255, 120, 117, 0.65);
}

.traffic-light-close svg {
  stroke: rgba(0, 0, 0, 0.35);
}

.traffic-light-close:hover svg {
  stroke: rgba(0, 0, 0, 0.55);
}

/* Pin button - neutral gray filled circle (unpinned state) */
.traffic-light-pin {
  background-color: rgba(150, 150, 150, 0.5);
}

.traffic-light-pin svg {
  stroke: rgba(0, 0, 0, 0.35);
  transition: transform 0.15s ease;
}

.traffic-light-pin:hover svg {
  stroke: rgba(0, 0, 0, 0.55);
}

/* Pin button - pinned state: orange background, rotated 45° */
.traffic-light-pin.pinned {
  background-color: rgba(255, 165, 0, 0.65);
}

.traffic-light-pin.pinned svg {
  transform: rotate(45deg);
  stroke: rgba(0, 0, 0, 0.5);
}

.traffic-light-pin.pinned:hover svg {
  stroke: rgba(0, 0, 0, 0.7);
}

/* Fullscreen button - soft green outline only (not filled) */
.traffic-light-fullscreen {
  background-color: transparent;
  border: 1.5px solid rgba(80, 200, 100, 0.6);
}

.traffic-light-fullscreen svg {
  stroke: rgba(80, 200, 100, 0.7);
}

.traffic-light-fullscreen:hover {
  background-color: rgba(80, 200, 100, 0.12);
}

.traffic-light-fullscreen:hover svg {
  stroke: rgba(60, 180, 80, 0.85);
}

/* =============================================================================
 * Terminal Window Chrome (Phase 4)
 * Minimal title bar with traffic lights at far right
 * Optional context badge for terminals with context nodes
 * ============================================================================= */

/* Terminal title bar - minimal height, relative positioning for traffic lights
 * Draggable area for moving the terminal window */
.terminal-title-bar {
  position: relative;
  min-height: 28px;
  padding: 4px 10px;
  background-color: var(--muted);
  border-bottom: 1px solid var(--border);
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
  display: flex;
  align-items: center;
  cursor: grab;
}

.terminal-title-bar:active {
  cursor: grabbing;
}

/* Traffic lights container - positioned at far right */
.terminal-traffic-lights {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Context badge - pill shape with clipboard icon and truncated title */
.terminal-context-badge {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  background-color: var(--accent);
  border-radius: 12px;
  cursor: pointer;
  transition: background-color 0.15s ease;
  max-width: 200px;
}

.terminal-context-badge:hover {
  background-color: var(--accent-foreground);
}

.terminal-context-badge svg {
  flex-shrink: 0;
  stroke: var(--muted-foreground);
}

.terminal-context-badge-title {
  font-size: 12px;
  color: var(--foreground);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Context expanded state - visual indicator */
.cy-floating-window-terminal.terminal-context-expanded .terminal-context-badge {
  background-color: var(--primary);
}

.cy-floating-window-terminal.terminal-context-expanded .terminal-context-badge svg {
  stroke: var(--primary-foreground);
}

.cy-floating-window-terminal.terminal-context-expanded .terminal-context-badge-title {
  color: var(--primary-foreground);
}

/* Terminal windows should not have horizontal scroll - xterm.js manages its own rendering.
 * On Windows, scrollbars take up physical space (~17px) causing FitAddon to miscalculate column width.
 * Solution: scrollbar-gutter: stable reserves space for scrollbar before it appears, ensuring
 * consistent width calculations. overflow-x: hidden as fallback for older browsers. */
.cy-floating-window-terminal .cy-floating-window-content {
  scrollbar-gutter: stable;
  overflow-x: hidden;
}

/* =============================================================================
 * Settings Editor Title Bar
 * Simple title bar with close button - similar to terminal but simpler
 * ============================================================================= */

/* Settings title bar - minimal height with close button and title */
.settings-title-bar {
  position: relative;
  min-height: 28px;
  padding: 4px 10px;
  background-color: var(--muted);
  border-bottom: 1px solid var(--border);
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: grab;
}

.settings-title-bar:active {
  cursor: grabbing;
}

/* Settings title text */
.settings-title-text {
  font-size: 12px;
  font-weight: 500;
  color: var(--muted-foreground);
}

/* Settings close button - pushed to far right */
.settings-title-bar .traffic-light-close {
  margin-left: auto;
}